<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>GreyMapper</title>
<link href="YMap.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="YTree.js"></script>
<script type="text/javascript" src="YView.js"></script>
<script type="text/javascript" src="YMap.js"></script>
<script type="text/javascript">
function init() {
// Extract YTree id from url and load unles it is missing -- then this is new.
	var yTree = new YTree();
  var rNode = null;
  if (id) {
    rNode = yTree.createRootNode("Loading...");
  } else {
    rNode = yTree.createRootNode("New MindWeb");
  }
	var yView = new YView(yTree, document.getElementById("panelDOM"), document.getElementById("panelSVG"));
	yView.drawNode(rNode, true);

  var title = "{{title|escape}}";
  var id = parseInt("{{id|escape}}");
  var revision = parseInt("{{revision|escape}}");
  if (id) {
    var xhr;
    if (window.XMLHttpRequest) {
      xhr = new XMLHttpRequest();
    } else if (window.ActiveXObject) {
      xhr = new ActiveXObject("Microsoft.XMLHTTP");
    }
    xhr.onreadystatechange = function() {
      if (xhr.readyState == 4) {
        if(xhr.status == 200) {
          yTree.loadFromXML(xhr.responseText);
          yTree.id = id;
          yView.setContentTitle(title);
          yView.redrawTree();
        } else {
          alert("An error occurred while loading: " + xhr.status);
        }
      }
    }
    var url = "/map/xml/" + id;
    if (revision) {
      url += ";"+revision;
    }
    xhr.open('GET', url, true);
    xhr.send(null);
  } 
	//var yView = new YView(yTree, document.getElementById("panelDOM"), document.getElementById("panelSVG"));
}

</script>

</head>

<body style="margin:0px" onload="init();">

<div id="panelDOM" style="position:absolute;width:100%;height:100%;margin:0px;padding:0px;overflow:visible;border:solid 1px gray;">
<svg id="panelSVG" xmlns="http://www.w3.org/2000/svg" version="1.1" >
</svg>
</div>


</body>

</html>
